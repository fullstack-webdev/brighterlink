<div id="companypanel-sources" class="companypanel-sources" ng-controller="CompanySourcesController">
    <!-- Start of source panel -->
    <div class="panel facility-list-panel" ng-show="activePanelIndex == 0">
        <div class="panel-header">
            <h4 class="panel-title">Sources</h4>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section section-well create-source-section">
                        <p class="description">Here you can manage all data sources and related items <i class="bv-marker bv-facilities"></i><span class="custom-text color-damson">Facilities</span><i class="bv-marker bv-scopes"></i><span class="custom-text color-orange">Scopes</span> and <i class="bv-marker bv-nodes"></i><span class="custom-text color-green">Nodes</span></p>
                        <a class="btn btn-bv-default btn-create-source" ng-click="openCreateFacility();"><span class="icon icon-bv-add"></span><span class="text">Create Sources</span></a>
                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section search-section">
                        <input type="text" id="search-box" class="form-control" placeholder="Search" ng-model="searchTag.name" ng-change="startSearchTags()" ng-blur="endSearchTags()">
                        <span class="icon bv-find"></span>
                    </div>
                    <div class="search-panel" ng-show="searchPanel">
                        <ul class="source-list">
                            <li class="no-match" ng-show="noMatch">
                                <p>No Match Sources</p>
                            </li>
                            <li class="type-facility" ng-repeat="facility in resultFacilities | filter:searchTag | orderBy:'name'">
                                <h5 class="item-title"><a class="item-link" ng-click="showFacilityDetail(facility, 'search')"><i class="icon-source-type"></i>{{facility.name}}</a></h5>
                            </li>
                            <li class="type-scope" ng-repeat="scope in resultScopes | filter:searchTag | orderBy:'name'">
                                <h5 class="item-title"><a class="item-link" ng-click="showScopeDetail(scope, 'search')"><i class="icon-source-type"></i>{{scope.name}}</a></h5>
                            </li>
                            <li class="type-node" ng-repeat="node in resultNodes | filter:searchTag | orderBy:'name'">
                                <h5 class="item-title"><a class="item-link" ng-click="showNodeDetail(node, 'search')"><i class="icon-source-type"></i>{{node.name}}</a></h5>
                            </li>
                            <li class="type-metric" ng-repeat="metric in resultMetrics | filter:searchTag | orderBy:'name'">
                                <h5 class="item-title"><a class="item-link" ng-click="showMetricDetail(metric, 'search')"><i class="icon-source-type"></i>{{metric.name}}</a></h5>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="filter-panel section">
                        <ul class="nav filter-list">
                            <li class="type-facility">
                                <input type="checkbox" ng-model="showFacilities">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-damson">Facilities</span>
                            </li>
                            <li class="type-scope">
                                <input type="checkbox" ng-model="showScopes">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-orange">Scopes</span>
                            </li>
                            <li class="type-node">
                                <input type="checkbox" ng-model="showNodes">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-green">Nodes</span>
                            </li>
                            <li class="type-metric">
                                <input type="checkbox" ng-model="showMetrics">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-dark-blue">Metrics</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="ajax_loading_panel" ng-show="sourceLoading"></div>
                    <h2 class="error-message margin-top-40 text-center" ng-if="!facilities.length && !sourceLoading"><br/><i>No accessible sources</i></h2>
                    <div class="section related-sources-section">
                        <div class="section-body source-list-result" m-custom-scrollbar="">
                            <ul class="source-list" id="facility-list-section" ng-show="showFacilities || (!showScopes && !showNodes && !showMetrics)">
                                <li class="source-item type-facility facility-{{facility._id}}" ng-repeat="facility in resultFacilities | orderBy:'name'" ng-init="facility.toggleDelete = false">
                                <!-- <li class="source-item type-facility facility-{{facility._id}}" ng-repeat="facility in resultFacilities | searchFor:searchSource track by $index" ng-init="facility.toggleDelete = false"> -->
                                    <div ng-show="!facility.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showFacilityDetail(facility, 'result')">
                                            <i class="icon-source-type"></i>
                                            {{facility.name || 'Unnamed Facility'}}</a>
                                            <i class="icon-bv-trash" ng-click="toggleDeleteSource(facility, 'facility', 'list', 'show', $event)"></i>
                                        </h4>
                                        <p>{{facility.address || 'Not specified'}}</p>
                                    </div>
                                    <delete-dialog ng-show="facility.toggleDelete" data-yes="deleteFacility(facility._id, 'list')" data-no="toggleDeleteSource(facility, 'facility', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                            <ul class="source-list" id="scope-list-section" ng-show="showScopes">
                                <li class="source-item type-scope scope-{{scope._id}}" ng-repeat="scope in resultScopes | orderBy:'name'" ng-init="scope.toggleDelete = false">
                                    <div ng-show="!scope.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showScopeDetail(scope, 'result')"><i class="icon-source-type"></i>{{scope.name || 'Unnamed Scope'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(scope, 'scope', 'list', 'show', $event)"></i></h4>
                                        <p>{{(scope.device || 'Unnamed Device') + ', ' + (scope.deviceID || 'Unnamed Device ID')}}</p>
                                    </div>
                                    <delete-dialog ng-show="scope.toggleDelete" data-yes="deleteScope(scope._id, 'list')" data-no="toggleDeleteSource(scope, 'scope', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                            <ul class="source-list" id="node-list-section" ng-show="showNodes">
                                <li class="source-item type-node node-{{node._id}}" ng-repeat="node in resultNodes | orderBy:'name'" ng-init="node.toggleDelete = false">
                                    <div ng-show="!node.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showNodeDetail(node, 'result')"><i class="icon-source-type"></i>{{node.name || 'Unnamed Node'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(node, 'node', 'list', 'show', $event)"></i></h4>
                                        <p>{{(node.device || 'Unnamed Device') + ', ' + (node.deviceID || 'Unnamed Device ID')}}</p>
                                    </div>
                                    <delete-dialog ng-show="node.toggleDelete" data-yes="deleteNode(node._id, 'list')" data-no="toggleDeleteSource(node, 'node', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                            <ul class="source-list" id="metric-list-section" ng-show="showMetrics">
                                <li class="source-item type-metric metric-{{metric._id}}" ng-repeat="metric in resultMetrics | orderBy:'name'" ng-init="metric.toggleDelete = false">
                                    <div ng-show="!metric.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showMetricDetail(metric, 'result')"><i class="icon-source-type"></i>{{metric.name || 'Unnamed Metric'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(metric, 'metric', 'list', 'show', $event)"></i></h4>
                                    </div>
                                    <delete-dialog ng-show="metric.toggleDelete" data-yes="deleteMetric(metric._id, 'list')" data-no="toggleDeleteSource(metric, 'metric', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="page-box">
                    <table cellspacing="0" cellpadding="0" border="0">
                        <tbody>
                            <tr>
                                <td><span style="padding-right:4px;">Displaying page</span></td>
                                <td><span style="padding-right:4px;">{{currentPage}}</span></td>
                                <td><span style="padding-right:4px;">of</span></td>                        
                                <td><span style="padding-right:4px;">{{totalPage}}</span></td>
                                <td>
                                    <a ng-click="goFirstPage();" href="javascript:void(0)" ng-class="currentPage == 1 ? 'l-btn-disabled' : ''" class="l-btn l-btn-small  l-btn-plain">
                                        <span class="l-btn-left l-btn-icon-left"><span class="l-btn-text l-btn-empty">&nbsp;</span>
                                        <span class="l-btn-icon pagination-first">&nbsp;</span></span>
                                    </a>
                                </td>
                                <td>
                                    <a ng-click="goPrevPage();" href="javascript:void(0)" ng-class="currentPage == 1 ? 'l-btn-disabled' : ''" class="l-btn l-btn-small l-btn-plain">
                                        <span class="l-btn-left l-btn-icon-left"><span class="l-btn-text l-btn-empty">&nbsp;</span>
                                        <span class="l-btn-icon pagination-prev">&nbsp;</span></span>
                                    </a>
                                </td>
                                <td>
                                    <div class="pagination-btn-separator"></div>
                                </td>
                                <td>
                                    <input class="pagination-num" type="text" value="1" size="2" readonly ng-model="currentPage">
                                </td>
                                <td>
                                    <div class="pagination-btn-separator"></div>
                                </td>
                                <td>
                                    <a ng-click="goNextPage();" href="javascript:void(0)" ng-class="currentPage == totalPage ? 'l-btn-disabled' : ''" class="l-btn l-btn-small l-btn-plain">
                                        <span class="l-btn-left l-btn-icon-left"><span class="l-btn-text l-btn-empty">&nbsp;</span>
                                        <span class="l-btn-icon pagination-next">&nbsp;</span></span>
                                    </a>
                                </td>
                                <td>
                                    <a ng-click="goLastPage();" href="javascript:void(0)" ng-class="currentPage == totalPage ? 'l-btn-disabled' : ''" class="l-btn l-btn-small l-btn-plain">
                                        <span class="l-btn-left l-btn-icon-left"><span class="l-btn-text l-btn-empty">&nbsp;</span>
                                        <span class="l-btn-icon pagination-last">&nbsp;</span></span>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- End of source panel -->

    <!-- Start of create facility panel -->
    <div class="panel create-facility-panel" ng-show="activePanelIndex == 4">
        <div class="panel-header has-border">
            <h4 class="panel-title">Add Source</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(); activePanelIndex = oldPanelIndex"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body ">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <div class="ajax_loading_panel" ng-show="ajax_loading"></div>
                        <form class="form-horizontal source-form">
                            <div class="form-group">
                                <label for="selSourceType" class="col-sm-3 control-label">Tag Type</label>
                                <div class="col-sm-9" ng-init="sourceType = 1; listParents = {};">
                                    <select id="selSourceType" name="sourceType" class="form-control" ng-model="sourceType" ng-change="initializeFormValidation(); changeSourceType('source')">
                                        <option value="1">Facility</option>
                                        <option value="2">Scope</option>
                                        <option value="3">Node</option>
                                        <option value="4">Metric</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" ng-show="sourceType == 2">
                                <label for="chkNestedScope" class="col-sm-3 control-label">Nest This Scope</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="scopeNesting" name="chkNestedScope" id="chkNestedScope" class="form-checkbox" ng-change="changeSourceType('parent', scopeNesting ? scopeParent : facilityParent);" >
                                </div>
                            </div>
                            <div class="form-group" ng-show="sourceType != 1">
                                <label class="col-sm-3 control-label" ng-show="sourceType != 2">Parents</label>
                                <label class="col-sm-3 control-label" ng-show="sourceType == 2 && !scopeNesting">Parents (Facility)</label>
                                <label class="col-sm-3 control-label" ng-show="sourceType == 2 && scopeNesting">Parents (Scope)</label>
                                <div class="col-sm-9">
                                    <ui-select ng-model="facilityParent" theme="bootstrap" id="dataSourceParent" name="dataSourceParent" ng-show="sourceType == 2 && !scopeNesting" ng-change="changeSourceType('parent', facilityParent);" required>
                                        <ui-select-match placeholder="Select Parents">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="parent._id as parent in resultFacilities | filter: $select.search | orderBy:'name'">
                                            {{parent.name}}
                                        </ui-select-choices>
                                    </ui-select>
                                    <ui-select ng-model="scopeParent" theme="bootstrap" id="dataSourceParent" name="dataSourceParent" ng-show="sourceType == 3 || (sourceType == 2 && scopeNesting)" ng-change="changeSourceType('parent', scopeParent);">
                                        <ui-select-match placeholder="Select Parents">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="parent._id as parent in resultScopes | filter: $select.search | orderBy:'name'" required>
                                            {{parent.name}}
                                        </ui-select-choices>
                                    </ui-select>
                                    <ui-select ng-model="nodeParent" theme="bootstrap" id="dataSourceParent" name="dataSourceParent" ng-show="sourceType == 4" ng-change="changeSourceType('parent', nodeParent);">
                                        <ui-select-match placeholder="Select Parents">{{$select.selected.name}}</ui-select-match>
                                        <ui-select-choices repeat="parent._id as parent in resultNodes | filter: $select.search | orderBy:'name'" required>
                                            {{parent.name}}
                                        </ui-select-choices>
                                    </ui-select>
                                </div>
                            </div>
                        </form>
                        <div class="separater" style="margin-top: 20px; margin-bottom: 20px;"></div>
                        <form name="createFacilityForm" class="form-horizontal source-form" ng-submit="createFacility(createFacilityForm)" ng-show="sourceType == 1" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityName.$invalid && (createFacilityForm.addFacilityName.$dirty || submitted)}">
                                <label for="addFacilityName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addFacility.name" name="addFacilityName" id="addFacilityName" class="form-control" required/>
                                    <span class="help-block" ng-show="createFacilityForm.addFacilityName.$error.required && (createFacilityForm.addFacilityName.$dirty || submitted)">Please input a facility name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityDisplayName.$invalid && (createFacilityForm.addFacilityDisplayName.$dirty || submitted)}">
                                <label for="addFacilityDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addFacility.displayName" name="addFacilityDisplayName" id="addFacilityDisplayName" class="form-control" />
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityAddress.$invalid && (createFacilityForm.addFacilityAddress.$dirty || submitted)}">
                                <label for="addFacilityAddress" class="col-sm-3 control-label">Address</label>
                                <div class="col-sm-9">
                                    <textarea ng-model="addFacility.address" name="addFacilityAddress" id="addFacilityAddress" class="form-control" rows="3" required></textarea>
                                    <span class="help-block" ng-show="createFacilityForm.addFacilityAddress.$error.required && (createFacilityForm.addFacilityAddress.$dirty || submitted)">Please input an address.</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="addFacilityUxProvider" class="col-sm-3 control-label">Utility Provider</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete name="addFacilityUxProvider" id="addFacilityUxProvider" data-placeholder="Example: Kansas City Power and Light" data-model="addFacility.utilityProvider" data-func="getUtilities" data-loading="utilitiesLoading"></predictive-auto-complete>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="addFacilityTaxID" class="col-sm-3 control-label">Tax ID</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addFacility.taxID" name="addFacilityTaxID" id="addFacilityTaxID" class="form-control" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="addFacilityNonProfit" class="col-sm-3 control-label">NonProfit</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addFacility.nonProfit" name="addFacilityNonProfit" id="addFacilityNonProfit" class="form-checkbox" >
                                </div>
                            </div>
                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addFacilityBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addFacility.bpLock" name="addFacilityBpLock" id="addFacilityBpLock" class="form-checkbox" >
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityUtilityAccount.$invalid && (createFacilityForm.addFacilityUtilityAccount.$dirty || submitted)}">
                                <label for="addFacilityUtilityAccount" class="col-sm-3 control-label">Utility Account</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addFacility.utilityAccount" id="addFacilityUtilityAccount" name="addFacilityUtilityAccount" class="form-control">
                                    <span class="help-block" ng-show="createFacilityForm.addFacilityUtilityAccount.$error.required && (createFacilityForm.addFacilityUtilityAccount.$dirty || submitted)">Please input an utility account.</span>
                                    <p class="help-block">Sperated by comma(,)</p>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityBillingInterval.$invalid && (createFacilityForm.addFacilityBillingInterval.$dirty || submitted)}">
                                <label for="addFacilityBillingInterval" class="col-sm-3 control-label">Billing Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="addFacility.billingInterval" id="addFacilityBillingInterval" name="addFacilityBillingInterval" class="form-control" data-placeholder="Select Billing Interval" required>
                                        <option value="15">15 minutes</option>
                                        <option value="30">30 minutes</option>
                                        <option value="60">60 minutes</option>
                                    </select>
                                    <span class="help-block" ng-show="createFacilityForm.addFacilityBillingInterval.$error.required && (createFacilityForm.addFacilityBillingInterval.$dirty || submitted)">Please select a billing interval.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createFacilityForm.addFacilityConstEmissionFactor.$invalid && (createFacilityForm.addFacilityConstEmissionFactor.$dirty || submitted)}">
                                <label for="addFacilityConstEmissionFactor" class="col-sm-3 control-label">constEmissionFactor</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addFacility.constEmissionFactor" name="addFacilityConstEmissionFactor" id="addFacilityConstEmissionFactor" class="form-control" placeholder="0.000823724" />
                                    <span class="help-block" ng-show="(createFacilityForm.addFacilityConstEmissionFactor.$error.number) && (createFacilityForm.addFacilityConstEmissionFactor.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="addFacilityImageUpload" class="col-sm-3 control-label">Upload Image</label>
                                <div class="col-sm-9">
                                    <input type="file" id="addFacilityImageUpload" name="addFacilityImageUpload" onchange="angular.element(this).scope().uploadFacilityImage(this, true)" accept="image/*" />
                                    <p class="help-block">Feel free to upload your own image directly from your computer. The file should be less than 3MB.</p>
                                    <span class="help-block" ng-show="facilityImageUploadStatus == 'FAIL'" style="color: #e74c3c">Image upload failed. Please try again.</span>
                                    <span class="help-block" ng-show="facilityImageUploadStatus == 'SUCCESS'" style="color: #2a6496">Image uploaded successfully. Please go on and click Add Facility button.</span>
                                    <p ng-show="addFacility.image">
                                        <img src="{{addFacility.image}}" style="max-width: 100%; max-height: 400px" />
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 230px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit">Add Facility</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createFacilityForm); activePanelIndex = oldPanelIndex">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form name="createScope2Form" class="form-horizontal source-form" ng-submit="createScope(createScope2Form)" ng-show="sourceType == 2" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Name.$invalid && (createScope2Form.addScope2Name.$dirty || submitted)}">
                                <label for="addScope2Name" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.name" name="addScope2Name" id="addScope2Name" class="form-control" required/>
                                    <span class="help-block" ng-show="createScope2Form.addScope2Name.$error.required && (createScope2Form.addScope2Name.$dirty || submitted)">Please input a Scope name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2DisplayName.$invalid && (createScope2Form.addScope2DisplayName.$dirty || submitted)}">
                                <label for="addScope2DisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.displayName" name="addScope2DisplayName" id="addScope2DisplayName" class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Mfr.$invalid && (createScope2Form.addScope2Mfr.$dirty || submitted)}">
                                <label for="addScope2Mfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete name="addScope2Mfr" id="addScope2Mfr" data-placeholder="" data-model="addScope.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createScope2Form.addScope2Mfr.$error.required && (createScope2Form.addScope2Mfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Device.$invalid && (createScope2Form.addScope2Device.$dirty || submitted)}">
                                <label for="addScope2Device" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete name="addScope2Device" id="addScope2Device" data-placeholder="" data-model="addScope.device" data-func="getDevices" data-loading="deviceLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createScope2Form.addScope2Device.$error.required && (createScope2Form.addScope2Device.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2DeviceId.$invalid && (createScope2Form.addScope2DeviceId.$dirty || submitted)}">
                                <label for="addScope2DeviceId" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <input type="text" name="addScope2DeviceId" id="addScope2DeviceId" ng-model="addScope.deviceID" class="form-control" required/>
                                    <span class="help-block" ng-show="createScope2Form.addScope2DeviceId.$error.required && (createScope2Form.addScope2DeviceId.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2AccessMethod.$invalid && (createScope2Form.addScope2AccessMethod.$dirty || submitted)}">
                                <label for="addScope2AccessMethod" class="col-sm-3 control-label">Access Method</label>
                                <div class="col-sm-9">
                                    <select ng-model="addScope.accessMethod" id="addScope2AccessMethod" name="addScope2AccessMethod" class="form-control" data-placeholder="Choose Method" required>
                                        <option value="">--- Choose Method ---</option>
                                        <option value="Push to FTP">Push to FTP</option>
                                        <option value="Push to URI">Push to URI</option>
                                        <option value="Download from FTP">Download from FTP</option>
                                        <option value="Download via API">Download via API</option>
                                    </select>
                                    <span class="help-block" ng-show="createScope2Form.addScope2AccessMethod.$error.required && (createScope2Form.addScope2AccessMethod.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addScope.accessMethod != null" ng-class="{'has-error': addScope.hasAuth && !addScope.username.length}">
                                <label for="addScope2Username" class="col-sm-3 control-label">Username</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.username" name="addScope2Username" id="addScope2Username" class="form-control"/>
                                    <span class="help-block" ng-show="addScope.hasAuth && !addScope.username.length">Please input username.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addScope.accessMethod != null" ng-class="{'has-error': addScope.hasAuth && !addScope.password.length}">
                                <label for="addScope2Password" class="col-sm-3 control-label">Password</label>
                                <div class="col-sm-9">
                                    <input type="password" ng-model="addScope.password" name="addScope2Password" id="addScope2Password" class="form-control"/>
                                    <span class="help-block" ng-show="addScope.hasAuth && !addScope.password.length">Please input password.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-show="addScope.accessMethod != null">
                                <label for="addScope2HasAuth" class="col-sm-3 control-label">Use Auth</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addScope.hasAuth" name="addScope2HasAuth" id="addScope2HasAuth" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group" ng-show="(addScope.accessMethod == 'Download from FTP') || (addScope.accessMethod == 'Download via API')">
                                <label for="addScope2WebAddress" class="col-sm-3 control-label">Web Address</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.webAddress" name="addScope2WebAddress" id="addScope2WebAddress" class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addScope.accessMethod == 'Push to FTP') || (addScope.accessMethod == 'Push to URI')">
                                <label for="addScope2Destination" class="col-sm-3 control-label">Destination</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.destination" name="addScope2Destination" id="addScope2Destination" class="form-control" placeholder="Example: 317 Broadway, New York NY 10007"/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Interval.$invalid && (createScope2Form.addScope2Interval.$dirty || submitted)}">
                                <label for="addScope2Interval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="addScope.interval" id="addScope2Interval" name="addScope2Interval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="createScope2Form.addScope2Interval.$error.required && (createScope2Form.addScope2Interval.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Lat.$invalid && (createScope2Form.addScope2Lat.$dirty || submitted)}">
                                <label for="addScope2Lat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addScope.latitude" name="addScope2Lat" id="addScope2Lat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(createScope2Form.addScope2Lat.$error.number || createScope2Form.addScope2Lat.$error.required) && (createScope2Form.addScope2Lat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Lng.$invalid && (createScope2Form.addScope2Lng.$dirty || submitted)}">
                                <label for="addScope2Lng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addScope.longitude" name="addScope2Lng" id="addScope2Lng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(createScope2Form.addScope2Lng.$error.number || createScope2Form.addScope2Lng.$error.required) && (createScope2Form.addScope2Lng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2WxStation.$invalid && (createScope2Form.addScope2WxStation.$dirty || submitted)}">
                                <label for="addScope2WxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.weatherStation" name="addScope2WxStation" id="addScope2WxStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="createScope2Form.addScope2WxStation.$error.required && (createScope2Form.addScope2WxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <!--div class="form-group" ng-class="{'has-error': createScope2Form.addScope2Tz.$invalid && (createScope2Form.addScope2Tz.$dirty || submitted)}">
                                <label for="addScope2Tz" class="col-sm-3 control-label">Time Zone</label>
                                <div class="col-sm-9">
                                    <select id="addScope2Tz" name="addScope2Tz" ng-model="addScope.timezone" class="form-control" data-placeholder="Select Time Zone" ng-options="item for item in timeZoneList" required>
                                        <option value="">--- Select Time Zone ---</option>
                                    </select>
                                    <span class="help-block" ng-show="createScope2Form.addScope2Tz.$error.required && (createScope2Form.addScope2Tz.$dirty || submitted)">Please input a time zone.</span>
                                </div>
                            </div-->
                            <div class="form-group" ng-class="{'has-error': createScope2Form.addScope2TimeZone.$invalid && (createScope2Form.addScope2TimeZone.$dirty || submitted)}">
                                <label for="addScope2TimeZone" class="col-sm-3 control-label">DateTime Format</label>
                                <div class="col-sm-9">
                                    <select id="addScope2TimeZone" ng-model="addScope.dateTimeFormat" name="addScope2TimeZone" class="form-control" data-placeholder="Select DateTime Format" required>
                                        <option value="">--- Select DateTime Format ---</option>
                                        <option value="UTC">UTC</option>
                                        <option value="Local Time">Local Time</option>
                                        <option value="Automatic Daylight Savings">Automatic Daylight Savings</option>
                                    </select>
                                    <span class="help-block" ng-show="createScope2Form.addScope2TimeZone.$error.required && (createScope2Form.addScope2TimeZone.$dirty || submitted)">Please select datetime format.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addScopeBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addScope.bpLock" name="addScopeBpLock" id="addScopeBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addScopeSoftwareUpload" class="col-sm-3 control-label">Upload Device Software</label>
                                <div class="col-sm-9">
                                    <input type="file" ng-model="addScope.softwareUploadPuppet" id="addScopeSoftwareUpload" name="addScopeSoftwareUpload" onchange="angular.element(this).scope().uploadDeviceSoftware(this, true)" />
                                    <p class="help-block">Feel free to upload device software file directly from your computer.</p>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'FAIL'" style="color: #e74c3c">File upload failed. Please try again.</span>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'SUCCESS'" style="color: #2a6496">File uploaded to the server successfully. Please go on and click Add Scope button.</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 260px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit">Add Scope</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createScope2Form);activePanelIndex = 1">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form name="createNode2Form" class="form-horizontal source-form" ng-submit="createNode(createNode2Form)" ng-show="sourceType == 3" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Name.$invalid && (createNode2Form.addNode2Name.$dirty || submitted)}">
                                <label for="addNode2Name" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.name" name="addNode2Name" id="addNode2Name" class="form-control" required/>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Name.$error.required && (createNode2Form.addNode2Name.$dirty || submitted)">Please input a node name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2DisplayName.$invalid && (createNode2Form.addNode2DisplayName.$dirty || submitted)}">
                                <label for="addNode2DisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.displayName" name="addNode2DisplayName" id="addNode2DisplayName" class="form-control" required/>
                                    <span class="help-block" ng-show="createNode2Form.addNode2DisplayName.$error.required && (createNode2Form.addNode2DisplayName.$dirty || submitted)">Please input a node name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Mfr.$invalid && (createNode2Form.addNode2Mfr.$dirty || submitted)}">
                                <label for="addNode2Mfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addNode2Mfr" name="addNode2Mfr" data-placeholder="" data-model="addNode.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Mfr.$error.required && (createNode2Form.addNode2Mfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Device.$invalid && (createNode2Form.addNode2Device.$dirty || submitted)}">
                                <label for="addNode2Device" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addNode2Device" name="addNode2Device" data-placeholder="" data-model="addNode.device" data-func="getDevices" data-selected="selectedAddNode2Device" data-loading="deviceLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Device.$error.required && (createNode2Form.addNode2Device.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2DeviceId.$invalid && (createNode2Form.addNode2DeviceId.$dirty || submitted)}">
                                <label for="addNode2DeviceID" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <!--input type="text" name="addNode2DeviceId" id="addNode2DeviceId" ng-model="addNode.deviceID" class="form-control" required/-->
                                    <!--select name="addNode2DeviceId" id="addNode2DeviceId" ng-model="addNode.deviceID" class="form-control" required>
                                        <option ng-repeat="deviceID in addNode2DeviceIDList" value="{{deviceID}}">{{deviceID}}</option>
                                    </select-->
                                    <ui-select name="addNode2DeviceId" ng-model="addNode.deviceID" theme="bootstrap" reset-search-input="false" required="true">
                                        <ui-select-match>
                                            <span>{{$select.selected || $select.search}}</span>
                                            <!--a class="btn btn-xs btn-link pull-right" ng-click="clearDeviceIdInput($event, $select)"><i class="glyphicon glyphicon-remove"></i></a-->
                                        </ui-select-match>
                                        <ui-select-choices repeat="deviceID in (addNode2DeviceIDList | filter: $select.search )" refresh="refreshAddNode2DeviceIDResults($select)" refresh-delay="0">
                                            <span>{{deviceID}}</span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <span class="help-block" ng-show="createNode2Form.addNode2DeviceId.$error.required && (createNode2Form.addNode2DeviceId.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Target.$invalid && (createNode2Form.addNode2Target.$dirty || submitted)}">
                                <label for="addNode2Target" class="col-sm-3 control-label">Node Target</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.sensorTarget" name="addNode2Target" id="addNode2Target" class="form-control" required/>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Target.$error.required && (createNode2Form.addNode2Target.$dirty || submitted)">Please input a node target.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Type.$invalid && (createNode2Form.addNode2Type.$dirty || submitted)}">
                                <label for="addNode2Type" class="col-sm-3 control-label">Node Type</label>
                                <div class="col-sm-9">
                                    <select ng-model="addNode.nodeType" name="addNode2Type" id="addNode2Type" class="form-control" data-placeholder="Select Node Type" required>
                                        <option value="">--- Use NOAA ---</option>
                                        <option value="Solar">Solar</option>
                                        <option value="Generation">Generation</option>
                                        <option value="Supply">Supply</option>
                                        <option value="Demand">Demand</option>
                                        <option value="Thermostat">Thermostat</option>
                                    </select>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Type.$error.required && (createNode2Form.addNode2Type.$dirty || submitted)">Please select a node type.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Interval.$invalid && (createNode2Form.addNode2Interval.$dirty || submitted)}">
                                <label for="addNode2Interval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="addNode.interval" name="addNode2Interval" id="addNode2Interval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="createNode2Form.addNode2Interval.$error.required && (createNode2Form.addNode2Interval.$dirty || submitted)">Please input a interval.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Lat.$invalid && (createNode2Form.addNode2Lat.$dirty || submitted)}">
                                <label for="addNode2Lat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.latitude" name="addNode2Lat" id="addNode2Lat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(createNode2Form.addNode2Lat.$error.number || createNode2Form.addNode2Lat.$error.required) && (createNode2Form.addNode2Lat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2Lng.$invalid && (createNode2Form.addNode2Lng.$dirty || submitted)}">
                                <label for="addNode2Lng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.longitude" name="addNode2Lng" id="addNode2Lng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(createNode2Form.addNode2Lng.$error.number || createNode2Form.addNode2Lng.$error.required) && (createNode2Form.addNode2Lng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2WxStation.$invalid && (createNode2Form.addNode2WxStation.$dirty || submitted)}">
                                <label for="addNode2WxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.weatherStation" name="addNode2WxStation" id="addNode2WxStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="createNode2Form.addNode2WxStation.$error.required && (createNode2Form.addNode2WxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNode2Form.addNode2PotenTialPower.$invalid && (createNode2Form.addNode2PotenTialPower.$dirty || submitted)}">
                                <label for="addNode2PotenTialPower" class="col-sm-3 control-label">PotenTial Power</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.potentialPower" name="addNode2PotenTialPower" id="addNode2PotenTialPower" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="(createNode2Form.addNode2PotenTialPower.$error.number || createNode2Form.addNode2PotenTialPower.$error.required) && (createNode2Form.addNode2PotenTialPower.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addNodeBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addNode.bpLock" name="addNodeBpLock" id="addNodeBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 250px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit">Add Node</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createNode2Form); activePanelIndex = 2">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <form name="createMetric2Form" class="form-horizontal source-form" ng-show="sourceType == 4" ng-submit="createMetric(createMetric2Form)" novalidate="novalidate">
                            <div class="form-group" ng-init="addMetric.metricList = ''" ng-class="{'has-error': createMetric2Form.addMetric2List.$invalid && (createMetric2Form.addMetric2List.$dirty || submitted)}">
                                <label for="addMetric2List" class="col-sm-3 control-label">Metric</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.metricList" id="addMetric2List" name="addMetric2List" class="form-control" data-placeholder="Choose metric from the list" ng-change="selectMetricList()" required>
                                        <option value=""></option>
                                        <!--<option value="Watts (Power)">Watts (Power)</option>
                                        <option value="Watt-Hours">Watt-Hours</option>
                                        <option value="Max Watts">Max Watts</option>
                                        <option value="Min Watts">Min Watts</option>
                                        <option value="Irradiance">Irradiance</option>
                                        <option value="Frequency">Frequency</option>
                                        <option value="Current">Current</option>
                                        <option value="Reactive Power">Reactive Power</option>
                                        <option value="Pressure">Pressure</option>
                                        <option value="Volumetric Flow">Volumetric Flow</option>
                                        <option value="Mass-Flow">Mass-Flow</option>
                                        <option value="Resistance">Resistance</option>
                                        <option value="Apparent Power"> Apparent Power</option>
                                        <option value="Total Harmonic Distortion">Total Harmonic Distortion</option>
                                        <option value="Temperature">Temperature</option>
                                        <option value="Voltage">Voltage</option>
                                        <option value="Numeric">Numeric</option>
                                        <option value="Monetary">Monetary</option>
                                        <option value="Angle">Angle</option>
                                        <option value="Relative Humidity">Relative Humidity</option>
                                        <option value="Speed">Speed</option>-->
                                        <option ng-repeat="metric in metricList" ng-show="checkMetricName(metric.name)" value="{{metric.name}}">{{metric.name}}</option>
                                        <option value="custom">--Custom--</option>
                                    </select>
                                    <span class="help-block" ng-show="createMetric2Form.addMetric2List.$error.required && (createMetric2Form.addMetric2List.$dirty || submitted)">Please choose a metric type.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addMetric.metricList != ''" ng-init="addMetric.summaryMethod = 'Total'" ng-class="{'has-error': createMetric2Form.addMetricSummaryMethod.$invalid && (createMetric2Form.addMetricSummaryMethod.$dirty || submitted)}">
                                <label for="addMetricSummaryMethod" class="col-sm-3 control-label">Summary Method</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.summaryMethod" id="addMetric2SummaryMethod" name="addMetric2SummaryMethod" class="form-control" required>
                                        <option value="Total">Total</option>
                                        <option value="Average">Average</option>
                                        <option value="Count">Count</option>
                                        <option value="Minimum">Minimum</option>
                                        <option value="Maximum">Maximum</option>
                                        <option value="Median">Median</option>
                                    </select>
                                    <span class="help-block" ng-show="createMetric2Form.addMetric2SummaryMethod.$error.required && (createMetric2Form.addMetric2SummaryMethod.$dirty || submitted)">Please choose a summary method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addMetric.metricList != ''" ng-init="addMetric.metricType = 'Datafeed'">
                                <label for="addMetric2Type" class="col-sm-3 control-label">Metric Type</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.metricType" id="addMetric2Type" name="addMetric2Type" class="form-control" required>
                                        <option value="Datafeed">Datafeed</option>
                                        <option value="Calculated">Calculated</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricList != '')" ng-class="{'has-error': createMetric2Form.addMetric2ID.$invalid && (createMetric2Form.addMetric2ID.$dirty || submitted)}">
                                <label for="addMetric2ID" class="col-sm-3 control-label">Metric ID</label>
                                <div class="col-sm-9">
                                    <!--input type="text" ng-model="addMetric.metricID" id="addMetric2ID" name="addMetric2ID" class="form-control" required-->
                                    <!--select ng-model="addMetric.metricID" id="addMetric2ID" name="addMetric2ID" class="form-control" required>
                                        <option ng-repeat="deviceID in addMetricsDeviceIdList" value="{{deviceID}}">{{deviceID}}</option>
                                    </select-->
                                    <ui-select id="addMetric2ID" name="addMetric2ID" ng-model="addMetric.metricID" theme="bootstrap" reset-search-input="false" required="true">
                                        <ui-select-match><span>{{$select.selected || $select.search}}</span></ui-select-match>
                                        <ui-select-choices repeat="device in (addMetricsDeviceIdList | filter: $select.search)" refresh="refreshAddMetricsDeviceIDResults($select)" refresh-delay="0">
                                            <span>{{device}}</span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <span class="help-block" ng-show="createMetric2Form.addMetric2ID.$error.required && (createMetric2Form.addMetric2ID.$dirty || submitted)">Please input a metric ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricList == 'custom') && (addMetric.metricList != '')" ng-class="{'has-error': createMetric2Form.addMetric2Name.$invalid && (createMetric2Form.addMetric2Name.$dirty || submitted)}">
                                <label for="addMetric2Name" class="col-sm-3 control-label">Metric Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addMetric.name" id="addMetric2Name" name="addMetric2Name" class="form-control" required>
                                    <span class="help-block" ng-show="createMetric2Form.addMetric2Name.$error.required && (createMetric2Form.addMetric2Name.$dirty || submitted)">Please input a metric name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricType == 'Calculated') && (addMetric.metricList != '')">
                                <label for="addMetric2Formula" class="col-sm-3 control-label">Formula</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" id="addMetric2Formula" name="addMetric2Formula" ng-model="addMetric.formula"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 242px;">
                                            <button type="submit" class="btn btn-companypanel-green btn-add-metric">Add Metric</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createMetric2Form); activePanelIndex=3">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of create facility panel -->

    <!-- Start of edit facility panel -->
    <div class="panel edit-facility-panel" ng-show="activePanelIndex == 5">
        <div class="panel-header has-border">
            <h4 class="panel-title">Edit Facility</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(updateFacilityForm);activePanelIndex = 1"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <div class="ajax_loading_panel" ng-show="ajaxLoading"></div>
                        <form name="updateFacilityForm" class="form-horizontal source-form" ng-submit="updateFacility(updateFacilityForm)" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityName.$invalid && (updateFacilityForm.editFacilityName.$dirty || submitted)}">
                                <label for="editFacilityName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editFacility.name" name="editFacilityName" id="editFacilityName" class="form-control" required/>
                                    <span class="help-block" ng-show="updateFacilityForm.editFacilityName.$error.required && (updateFacilityForm.editFacilityName.$dirty || submitted)">Please input a facility name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityDisplayName.$invalid && (updateFacilityForm.editFacilityDisplayName.$dirty || submitted)}">
                                <label for="editFacilityDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editFacility.displayName" name="editFacilityDisplayName" id="editFacilityDisplayName" class="form-control" />
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityAddress.$invalid && (updateFacilityForm.editFacilityAddress.$dirty || submitted)}">
                                <label for="editFacilityAddress" class="col-sm-3 control-label">Address</label>
                                <div class="col-sm-9">
                                    <textarea ng-model="editFacility.address" name="editFacilityAddress" id="editFacilityAddress" class="form-control" rows="3" required></textarea>
                                    <span class="help-block" ng-show="updateFacilityForm.editFacilityAddress.$error.required && (updateFacilityForm.editFacilityAddress.$dirty || submitted)">Please input an address.</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="editFacilityUxProvider" class="col-sm-3 control-label">Utility Provider</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="editFacilityUxProvider" name="editFacilityUxProvider" data-placeholder="Example: Kansas City Power and Light" data-model="editFacility.utilityProvider" data-func="getUtilities" data-loading="utilitiesLoading"></predictive-auto-complete>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="editFacilityTaxID" class="col-sm-3 control-label">Tax ID</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editFacility.taxID" name="editFacilityTaxID" id="editFacilityTaxID" class="form-control" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="editFacilityNonProfit" class="col-sm-3 control-label">NonProfit</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="editFacility.nonProfit" name="editFacilityNonProfit" id="editFacilityNonProfit" class="form-checkbox" >
                                </div>
                            </div>
                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="editFacilityBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="editFacility.bpLock" name="editFacilityBpLock" id="editFacilityBpLock" class="form-checkbox" >
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityUtilityAccount.$invalid && (updateFacilityForm.editFacilityUtilityAccount.$dirty || submitted)}">
                                <label for="editFacilityUtilityAccount" class="col-sm-3 control-label">Utility Account</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editFacility.utilityAccount" name="editFacilityUtilityAccount" id="editFacilityUtilityAccount" class="form-control">
                                    <span class="help-block" ng-show="updateFacilityForm.editFacilityUtilityAccount.$error.required && (updateFacilityForm.editFacilityUtilityAccount.$dirty || submitted)">Please input an utility account.</span>
                                    <p class="help-block">Sperated by comma(,)</p>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityBillingInterval.$invalid && (updateFacilityForm.editFacilityBillingInterval.$dirty || submitted)}">
                                <label for="editFacilityBillingInterval" class="col-sm-3 control-label">Billing Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="editFacility.billingInterval" id="editFacilityBillingInterval" name="editFacilityBillingInterval" class="form-control" data-placeholder="Select Billing Interval" required>
                                        <option value="15">15 minutes</option>
                                        <option value="30">30 minutes</option>
                                        <option value="60">60 minutes</option>
                                    </select>
                                    <span class="help-block" ng-show="updateFacilityForm.editFacilityBillingInterval.$error.required && (updateFacilityForm.editFacilityBillingInterval.$dirty || submitted)">Please select a billing interval.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateFacilityForm.editFacilityConstEmissionFactor.$invalid && (updateFacilityForm.editFacilityConstEmissionFactor.$dirty || submitted)}">
                                <label for="editFacilityConstEmissionFactor" class="col-sm-3 control-label">constEmissionFactor</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editFacility.constEmissionFactor" name="editFacilityConstEmissionFactor" id="editFacilityConstEmissionFactor" class="form-control" placeholder="0.000823724" />
                                    <span class="help-block" ng-show="(updateFacilityForm.editFacilityConstEmissionFactor.$error.number) && (updateFacilityForm.editFacilityConstEmissionFactor.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="editFacilityImageUpload" class="col-sm-3 control-label">Facility Image</label>
                                <div class="col-sm-9">
                                    <p ng-show="editFacility.image">
                                        <img src="{{editFacility.image}}" style="max-width: 100%; max-height: 400px" />
                                    </p>
                                    <p ng-hide="editFacility.image">
                                        No Image Uploaded
                                    </p>
                                    <label ng-show="editFacility.image">Change Image</label>
                                    <input type="file" id="editFacilityImageUpload" name="editFacilityImageUpload" onchange="angular.element(this).scope().uploadFacilityImage(this, false)" accept="image/*" />
                                    <p class="help-block">Feel free to upload your own image directly from your computer. The file should be less than 3MB.</p>
                                    <span class="help-block" ng-show="facilityImageUploadStatus == 'FAIL'" style="color: #e74c3c">Image upload failed. Please try again.</span>
                                    <span class="help-block" ng-show="facilityImageUploadStatus == 'SUCCESS'" style="color: #2a6496">Image uploaded successfully. You need to click Update Facility button to save it.</span>                                    
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 250px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit">Update Facility</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(updateFacilityForm); activePanelIndex = oldPanelIndex;">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of edit facility panel -->

    <!-- Start of faciliity details panel -->
    <div class="panel facility-details-panel" ng-show="activePanelIndex == 1">
        <div class="panel-header">
            <h4 class="panel-title">Facility</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="backToSearchResult()"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section section-well create-source-section clearfix">
                        <p class="description">Here you can manage all data sources and related items <i class="bv-marker bv-facilities"></i><span class="custom-text color-damson">Facilities</span><i class="bv-marker bv-scopes"></i><span class="custom-text color-orange">Scopes</span> and <i class="bv-marker bv-nodes"></i><span class="custom-text color-green">Nodes</span></p>
                        <a class="btn btn-bv-default btn-create-source" ng-click="openCreateFacility();"><span class="icon icon-bv-add"></span><span class="text">Create Sources</span></a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section search-section">
                        <input type="text" class="form-control" placeholder="Search" ng-model="searchTag.name" ng-change="backToSearchResult()">
                        <span class="icon bv-find"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="filter-panel section">
                        <ul class="filter-list">
                            <li class="type-facility">
                                <input type="checkbox" ng-model="showFacilities" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-damson">Facilities</span>
                            </li>
                            <li class="type-scope">
                                <input type="checkbox" ng-model="showScopes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-orange">Scopes</span>
                            </li>
                            <li class="type-node">
                                <input type="checkbox" ng-model="showNodes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-green">Nodes</span>
                            </li>
                            <li class="type-metric">
                                <input type="checkbox" ng-model="showMetrics" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-dark-blue">Metrics</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="separater"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section detail-section facility-detail-section">
                        <delete-dialog ng-show="currentFacility.toggleDelete" data-yes="toggleDeleteSource(currentFacility, 'facility', 'detail','hide'); deleteFacility(currentFacility._id, 'detail');" data-no="toggleDeleteSource(currentFacility, 'facility', 'detail','hide');" data-message="Really Delete?"></delete-dialog>
                        <div class="section-head">
                            <h4 class="section-title"><span class="icon bv-marker bv-facilities"></span><span class="text color-damson">{{currentFacility.name || 'Unnamed Facility'}}</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-edit-facility" ng-click="openEditFacility();"><span class="icon icon-bv-edit"></span><span class="text">Edit</span></a>
                                <a class="btn btn-delete-facility" title="Sorry,we can't delete it now" tooltip="Sorry,we can't delete it now" ng-click="toggleDeleteSource(currentFacility, 'facility', 'detail', 'show');"><span class="icon icon-delete"></span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Display Name</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.displayName || currentFacility.name}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Address</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.address}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Utility Provider</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.utilityProvider || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Tax ID</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.taxID || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Utility Account</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.utilityAccounts.join(", ") || 'No Accounts'}} </div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Shared with</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value" ng-bind="currentFacility.accessibleUsers || 'None'"></div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Billing Interval</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.billingInterval || 30}} minutes</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">constEmissionFactor</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentFacility.constEmissionFactor || 'Default (0.000823724)'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Facility Image</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <p ng-show="currentFacility.image">
                                        <img src="{{currentFacility.image}}" style="max-width: 100%; max-height: 400px" />
                                    </p>
                                    <div class="field-value" ng-hide="currentFacility.image">
                                        No Image Uploaded<br/><br/><br/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row slide-sources-panel facility" id="related-sources-section">
                <div class="col-md-12 col-sm-12 slide-source-head">
                    <h3 ng-click="slideRelatedSources($event, 'click');">Related Scope<span><i class="fa fa-chevron-down"></i></span></h3>
                </div>
                <div class="col-md-12 col-sm-12">
                    <div class="section related-sources-section">
                        <div class="section-head">
                            <h4 class="section-title"><span class="text">Related Scope</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-add-scope" ng-click="scopeNesting = false; resetDeviceSoftwareUpload(); activePanelIndex = 6;"><span class="icon icon-bv-add"></span><span class="text">Add Scope</span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <ul class="source-list" id="dataloger-list-section">
                                <li class="source-item type-scope scope-{{scope._id}}" ng-repeat="scope in currentFacility.childTags | orderBy:'name'" ng-init="scope.toggleDelete = false">
                                    <div ng-show="!scope.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showScopeDetail(scope, 'normal')"><i class="icon-source-type"></i>{{scope.name || 'Unnamed Scope'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(scope, 'scope', 'list', 'show', $event)"></i></h4>
                                        <p>{{scope.deviceID}}</p>
                                    </div>
                                    <delete-dialog ng-show="scope.toggleDelete" data-yes="deleteScope(scope._id, 'list')" data-no="toggleDeleteSource(scope, 'scope', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of facility details panel -->

    <!-- Start of create scope panel -->
    <div class="panel create-scope-panel" ng-show="activePanelIndex == 6">
        <div class="panel-header has-border">
            <h4 class="panel-title">Add Scope</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(createScopeForm);activePanelIndex = 1"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section"  m-custom-scrollbar="">
                        <form name="createScopeForm" class="form-horizontal source-form" ng-submit="createScope(createScopeForm)" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeName.$invalid && (createScopeForm.addScopeName.$dirty || submitted)}">
                                <label for="addScopeName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" name="addScopeName" id="addScopeName" class="form-control" ng-model="addScope.name" required/>
                                    <span class="help-block" ng-show="createScopeForm.addScopeName.$error.required && (createScopeForm.addScopeName.$dirty || submitted)">Please input a Scope name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeDisplayName.$invalid && (createScopeForm.addScopeDisplayName.$dirty || submitted)}">
                                <label for="addScopeDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" name="addScopeDisplayName" id="addScopeDisplayName" class="form-control" ng-model="addScope.displayName" required/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeMfr.$invalid && (createScopeForm.addScopeMfr.$dirty || submitted)}">
                                <label for="addScopeMfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addScopeMfr" name="addScopeMfr" data-placeholder="" data-model="addScope.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createScopeForm.addScopeMfr.$error.required && (createScopeForm.addScopeMfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeDevice.$invalid && (createScopeForm.addScopeDevice.$dirty || submitted)}">
                                <label for="addScopeDevice" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addScopeDevice" name="addScopeDevice" data-placeholder="" data-model="addScope.device" data-func="getDevices" data-loading="deviceLoading"></predictive-auto-complete>
                                    <span class="help-block" ng-show="createScopeForm.addScopeDevice.$error.required && (createScopeForm.addScopeDevice.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeDeviceId.$invalid && (createScopeForm.addScopeDeviceId.$dirty || submitted)}">
                                <label for="addScopeDeviceId" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <input type="text" name="addScopeDeviceId" id="addScopeDeviceId" ng-model="addScope.deviceID" class="form-control" required/>
                                    <span class="help-block" ng-show="createScopeForm.addScopeDeviceId.$error.required && (createScopeForm.addScopeDeviceId.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeAccessMethod.$invalid && (createScopeForm.addScopeAccessMethod.$dirty || submitted)}">
                                <label for="addScopeAccessMethod" class="col-sm-3 control-label">Access Method</label>
                                <div class="col-sm-9">
                                    <select ng-model="addScope.accessMethod" name="addScopeAccessMethod" id="addScopeAccessMethod" class="form-control" data-placeholder="Choose Method" required>
                                        <option value="">--- Choose Method ---</option>
                                        <option value="Push to FTP">Push to FTP</option>
                                        <option value="Push to URI">Push to URI</option>
                                        <option value="Download from FTP">Download from FTP</option>
                                        <option value="Download via API">Download via API</option>
                                    </select>
                                    <span class="help-block" ng-show="createScopeForm.addScopeAccessMethod.$error.required && (createScopeForm.addScopeAccessMethod.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addScope.accessMethod != null" ng-class="{'has-error': addScope.hasAuth && !addScope.username.length}">
                                <label for="addScopeUsername" class="col-sm-3 control-label">Username</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.username" name="addScopeUsername" id="addScopeUsername" class="form-control"/>
                                    <span class="help-block" ng-show="addScope.hasAuth && !addScope.username.length">Please input username.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addScope.accessMethod != null" ng-class="{'has-error': addScope.hasAuth && !addScope.password.length}">
                                <label for="addScopePassword" class="col-sm-3 control-label">Password</label>
                                <div class="col-sm-9">
                                    <input type="password" ng-model="addScope.password" name="addScopePassword" id="addScopePassword" class="form-control"/>
                                    <span class="help-block" ng-show="addScope.hasAuth && !addScope.password.length">Please input password.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-show="addScope.accessMethod != null">
                                <label for="addScopeHasAuth" class="col-sm-3 control-label">Use Auth</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addScope.hasAuth" name="addScopeHasAuth" id="addScopeHasAuth" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group" ng-show="(addScope.accessMethod == 'Download from FTP') || (addScope.accessMethod == 'Download via API')">
                                <label for="addScopeWebAddress" class="col-sm-3 control-label">Web Address</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.webAddress" name="addScopeWebAddress" id="addScopeWebAddress" class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addScope.accessMethod == 'Push to FTP') || (addScope.accessMethod == 'Push to URI')">
                                <label for="addScopeDestination" class="col-sm-3 control-label">Destination</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.destination" name="addScopeDestination" id="addScopeDestination" class="form-control" placeholder="Example: 317 Broadway, New York NY 10007"/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeInterval.$invalid && (createScopeForm.addScopeInterval.$dirty || submitted)}">
                                <label for="addScopeInterval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="addScope.interval" name="addScopeInterval" id="addScopeInterval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="createScopeForm.addScopeInterval.$error.required && (createScopeForm.addScopeInterval.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeLat.$invalid && (createScopeForm.addScopeLat.$dirty || submitted)}">
                                <label for="addScopeLat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addScope.latitude" name="addScopeLat" id="addScopeLat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(createScopeForm.addScopeLat.$error.number || createScopeForm.addScopeLat.$error.required) && (createScopeForm.addScopeLat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeLng.$invalid && (createScopeForm.addScopeLng.$dirty || submitted)}">
                                <label for="addScopeLng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addScope.longitude" name="addScopeLng" id="addScopeLng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(createScopeForm.addScopeLng.$error.number || createScopeForm.addScopeLng.$error.required) && (createScopeForm.addScopeLng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeWxStation.$invalid && (createScopeForm.addScopeWxStation.$dirty || submitted)}">
                                <label for="addScopeWxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addScope.weatherStation" name="addScopeWxStation" id="addScopeWxStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="createScopeForm.addScopeWxStation.$error.required && (createScopeForm.addScopeWxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <!--div class="form-group" ng-class="{'has-error': createScopeForm.addScopeTz.$invalid && (createScopeForm.addScopeTz.$dirty || submitted)}">
                                <label for="addScopeTz" class="col-sm-3 control-label">Time Zone</label>
                                <div class="col-sm-9">
                                    <select id="addScopeTz" name="addScopeTz" ng-model="addScope.timezone" class="form-control" data-placeholder="Select Time Zone" ng-options="item for item in timeZoneList" required>
                                        <option value="">--- Select Time Zone ---</option>
                                    </select>
                                    <span class="help-block" ng-show="createScopeForm.addScopeTz.$error.required && (createScopeForm.addScopeTz.$dirty || submitted)">Please input a time zone.</span>
                                </div>
                            </div-->

                            <div class="form-group" ng-class="{'has-error': createScopeForm.addScopeTimeFormat.$invalid && (createScopeForm.addScopeTimeFormat.$dirty || submitted)}">
                                <label for="addScopeTimeFormat" class="col-sm-3 control-label">DateTime Format</label>
                                <div class="col-sm-9">
                                    <select id="addScopeTimeFormat" ng-model="addScope.dateTimeFormat" name="addScopeTimeFormat" class="form-control" data-placeholder="Select DateTime Format" required>
                                        <option value="">--- Select DateTime Format ---</option>
                                        <option value="UTC">UTC</option>
                                        <option value="Local Time">Local Time</option>
                                        <option value="Automatic Daylight Savings">Automatic Daylight Savings</option>
                                    </select>
                                    <span class="help-block" ng-show="createScopeForm.addScopeTimeFormat.$error.required && (createScopeForm.addScopeTimeFormat.$dirty || submitted)">Please input datetime format.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addScopeBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addScope.bpLock" name="addScopeBpLock" id="addScopeBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="addScopeSoftwareUpload" class="col-sm-3 control-label">Upload Device Software</label>
                                <div class="col-sm-9">
                                    <input type="file" id="addScopeSoftwareUpload" name="addScopeSoftwareUpload" onchange="angular.element(this).scope().uploadDeviceSoftware(this, true)" />
                                    <p class="help-block">Feel free to upload device software file directly from your computer.</p>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'FAIL'" style="color: #e74c3c">File upload failed. Please try again.</span>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'SUCCESS'" style="color: #2a6496">File uploaded to the server successfully. Please go on and click Add Scope button.</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 260px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit" ng-disabled="currentUser.enphaseUserId == null && addScope.manufacturer == 'Enphase'">Add Scope</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createScopeForm); activePanelIndex = 1">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of create scope panel -->

    <!-- Start of update scope panel -->
    <div class="panel edit-scope-panel" ng-show="activePanelIndex == 7">
        <div class="panel-header has-border">
            <h4 class="panel-title">Update Scope</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(updateScopeForm); activePanelIndex = 2"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <form name="updateScopeForm" class="form-horizontal source-form" ng-submit="updateScope(updateScopeForm)" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeName.$invalid && (updateScopeForm.editScopeName.$dirty || submitted)}">
                                <label for="editScopeName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" name="editScopeName" id="editScopeName" class="form-control" ng-model="editScope.name" required/>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeName.$error.required && (updateScopeForm.editScopeName.$dirty || submitted)">Please input a Scope name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeDisplayName.$invalid && (updateScopeForm.editScopeDisplayName.$dirty || submitted)}"> <label for="editScopeDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" name="editScopeDisplayName" id="editScopeDisplayName" class="form-control" ng-model="editScope.displayName"/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeMfr.$invalid && (updateScopeForm.editScopeMfr.$dirty || submitted)}">
                                <label for="editScopeMfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="editScopeMfr" name="editScopeMfr" data-placeholder="" data-model="editScope.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeMfr.$error.required && (updateScopeForm.editScopeMfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeDevice.$invalid && (updateScopeForm.editScopeDevice.$dirty || submitted)}">
                                <label for="editScopeDevice" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="editScopeDevice" name="editScopeDevice" data-placeholder="" data-model="editScope.device" data-func="getDevices" data-loading="deviceLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeDevice.$error.required && (updateScopeForm.editScopeDevice.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeDeviceID.$invalid && (updateScopeForm.editScopeDeviceID.$dirty || submitted)}">
                                <label for="editScopeDeviceID" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editScope.deviceID" name="editScopeDeviceID" id="editScopeDeviceID" class="form-control" required readonly/>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeDeviceID.$error.required && (updateScopeForm.editScopeDeviceID.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeAccessMethod.$invalid && (updateScopeForm.editScopeAccessMethod.$dirty || submitted)}">
                                <label for="editScopeAccessMethod" class="col-sm-3 control-label">Access Method</label>
                                <div class="col-sm-9">
                                    <select ng-model="editScope.accessMethod" name="editScopeAccessMethod" id="editScopeAccessMethod" class="form-control" data-placeholder="Choose Method" required>
                                        <option value="">--- Choose Method ---</option>
                                        <option value="Push to FTP">Push to FTP</option>
                                        <option value="Push to URI">Push to URI</option>
                                        <option value="Download from FTP">Download from FTP</option>
                                        <option value="Download via API">Download via API</option>
                                    </select>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeAccessMethod.$error.required && (updateScopeForm.editScopeAccessMethod.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="editScope.accessMethod != null" ng-class="{'has-error': editScope.hasAuth && !editScope.username.length}">
                                <label for="editScopeUsername" class="col-sm-3 control-label">Username</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editScope.username" name="editScopeUsername" id="editScopeUsername" class="form-control"/>
                                    <span class="help-block" ng-show="editScope.hasAuth && !editScope.username.length">Please input username.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="editScope.accessMethod != null" ng-class="{'has-error': editScope.hasAuth && !editScope.password.length}">
                                <label for="editScopePassword" class="col-sm-3 control-label">Password</label>
                                <div class="col-sm-9">
                                    <input type="password" ng-model="editScope.password" name="editScopePassword" id="editScopePassword" class="form-control"/>
                                    <span class="help-block" ng-show="editScope.hasAuth && !editScope.password.length">Please input password.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-show="editScope.accessMethod != null">
                                <label for="editScopeHasAuth" class="col-sm-3 control-label">Use Auth</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="editScope.hasAuth" name="editScopeHasAuth" id="editScopeHasAuth" class="form-checkbox" />
                                </div>
                            </div>


                            <div class="form-group" ng-show="(editScope.accessMethod == 'Download from FTP') || (editScope.accessMethod == 'Download via API')">
                                <label for="editScopeWebAddress" class="col-sm-3 control-label">Web Address</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editScope.webAddress" name="editScopeWebAddress" id="editScopeWebAddress" class="form-control"/>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(editScope.accessMethod == 'Push to FTP') || (editScope.accessMethod == 'Push to URI')">
                                <label for="editScopeDestination" class="col-sm-3 control-label">Destination</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editScope.destination" name="editScopeDestination" id="editScopeDestination" class="form-control" placeholder="Example: 317 Broadway, New York NY 10007"/>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeInterval.$invalid && (updateScopeForm.editScopeInterval.$dirty || submitted)}">
                                <label for="editScopeInterval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="editScope.interval" name="editScopeInterval" id="editScopeInterval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeInterval.$error.required && (updateScopeForm.editScopeInterval.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeLat.$invalid && (updateScopeForm.editScopeLat.$dirty || submitted)}">
                                <label for="editScopeLat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editScope.latitude" name="editScopeLat" id="editScopeLat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(updateScopeForm.editScopeLat.$error.number || updateScopeForm.editScopeLat.$error.required) && (updateScopeForm.editScopeLat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeLng.$invalid && (updateScopeForm.editScopeLng.$dirty || submitted)}">
                                <label for="editScopeLng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editScope.longitude" name="editScopeLng" id="editScopeLng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(updateScopeForm.editScopeLng.$error.number || updateScopeForm.editScopeLng.$error.required) && (updateScopeForm.editScopeLng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeWxStation.$invalid && (updateScopeForm.editScopeWxStation.$dirty || submitted)}">
                                <label for="editScopeWxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editScope.weatherStation" name="editScopeWxStation" id="editScopeWxStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeWxStation.$error.required && (updateScopeForm.editScopeWxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeTz.$invalid && (updateScopeForm.editScopeTz.$dirty || submitted)}">
                                <label for="editScopeTz" class="col-sm-3 control-label">Time Zone</label>
                                <div class="col-sm-9">
                                    <select id="editScopeTz" ng-model="editScope.timezone" name="editScopeTz" class="form-control" data-placeholder="Select Time Zone" ng-options="item for item in timeZoneList" ng-disabled="1" required>
                                        <option value="">--- Select Time Zone ---</option>
                                    </select>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeTz.$error.required && (updateScopeForm.editScopeTz.$dirty || submitted)">Please input a time zone.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateScopeForm.editScopeTimeFormat.$invalid && (updateScopeForm.editScopeTimeFormat.$dirty || submitted)}">
                                <label for="editScopeTimeFormat" class="col-sm-3 control-label">DateTime Format</label>
                                <div class="col-sm-9">
                                    <select id="editScopeTimeFormat" ng-model="editScope.dateTimeFormat" name="editScopeTimeFormat" class="form-control" data-placeholder="Select DateTime Format" required>
                                        <option value="">--- Select DateTime Format ---</option>
                                        <option value="UTC">UTC</option>
                                        <option value="Local Time">Local Time</option>
                                        <option value="Automatic Daylight Savings">Automatic Daylight Savings</option>
                                    </select>
                                    <span class="help-block" ng-show="updateScopeForm.editScopeTimeFormat.$error.required && (updateScopeForm.editScopeTimeFormat.$dirty || submitted)">Please select a access method.</span>
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="editScopeBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="editScope.bpLock" name="editScopeBpLock" id="editScopeBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="editScopeSoftwareUpload" class="col-sm-3 control-label">Upload Device Software</label>
                                <div class="col-sm-9">
                                    <input type="file" id="editScopeSoftwareUpload" name="editScopeSoftwareUpload" onchange="angular.element(this).scope().uploadDeviceSoftware(this, false)" />
                                    <p class="help-block">Feel free to upload device software file directly from your computer.</p>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'FAIL'" style="color: #e74c3c">File upload failed. Please try again.</span>
                                    <span class="help-block" ng-show="deviceSoftwareUploadStatus == 'SUCCESS'" style="color: #2a6496">File uploaded to the server successfully. You need to click Update Scope button to save it.</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 275px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit" ng-disabled="currentUser.enphaseUserId == null && editScope.manufacturer == 'Enphase'">Update Scope</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(updateScopeForm); activePanelIndex = 2">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of update scope panel -->

    <!-- Start of scope details panel -->
    <div class="panel scope-details-panel" ng-show="activePanelIndex == 2">
        <div class="panel-header">
            <h4 class="panel-title">Scope</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="backFacilityDetail()"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section section-well create-source-section clearfix">
                        <p class="description">Here you can manage all data sources and related items <i class="bv-marker bv-facilities"></i><span class="custom-text color-damson">Facilities</span><i class="bv-marker bv-scopes"></i><span class="custom-text color-orange">Scopes</span> and <i class="bv-marker bv-nodes"></i><span class="custom-text color-green">Nodes</span></p>
                        <a class="btn btn-bv-default btn-create-source" ng-click="openCreateFacility();"><span class="icon icon-bv-add"></span><span class="text">Create Sources</span></a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section search-section">
                        <input type="text" class="form-control" placeholder="Search" ng-model="searchTag.name" ng-change="backToSearchResult()">
                        <span class="icon bv-find"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="filter-panel section">
                        <ul class="filter-list">
                            <li class="type-facility">
                                <input type="checkbox" ng-model="showFacilities" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-damson">Facilities</span>
                            </li>
                            <li class="type-scope">
                                <input type="checkbox" ng-model="showScopes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-orange">Scopes</span>
                            </li>
                            <li class="type-node">
                                <input type="checkbox" ng-model="showNodes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-green">Nodes</span>
                            </li>
                            <li class="type-metric">
                                <input type="checkbox" ng-model="showMetrics" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-dark-blue">Metrics</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="separater"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section detail-section scope-detail-section">
                        <delete-dialog ng-show="currentScope.toggleDelete" data-yes="toggleDeleteSource(currentScope, 'scope', 'detail','hide'); deleteScope(currentScope._id, 'detail');" data-no="toggleDeleteSource(currentScope, 'scope', 'detail','hide');" data-message="Really Delete?"></delete-dialog>
                        <div class="section-head">
                            <h4 class="section-title"><span class="icon bv-marker bv-scopes"></span><span class="text color-orange">{{currentScope.name || 'Unnamed Scope'}}</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-edit-scope" ng-click="openEditScope();"><span class="icon icon-bv-edit"></span><span class="text">Edit</span></a>
                                <a class="btn btn-delete-scope" title="Sorry,we can't delete it now" tooltip="Sorry,we can't delete it now" ng-click="toggleDeleteSource(currentScope, 'scope', 'detail','show', $event);"><span class="icon icon-delete"></span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="" style="height: calc(100% - 460px);">
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Display Name</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.displayName || currentScope.name }}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Manufacturer</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.manufacturer || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Device</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.device || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Access Method</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.accessMethod || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                 <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Username</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.username}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Password</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.password}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Web Address</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.webAddress || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Destination</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.destination || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Interval</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.interval || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Latitude</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.latitude || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Longitude</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentScope.longitude || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Shared with</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value" ng-bind="currentScope.accessibleUsers || 'None'"></div>
                                </div>
                            </div>
                            <div class="row detail-item" ng-hide="currentUser.role != 'BP'">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name"><small>Uploaded Device Softwares</small></div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value" ng-repeat="software in currentScope.deviceSoftware | orderBy:'uploadedDate'">
                                        {{software.version}}
                                    </div>
                                    <div class="field-value" ng-show="currentScope.deviceSoftware.length == 0">
                                        N/A
                                    </div>
                                </div>
                            </div>
                            <div class="row detail-item" ng-hide="currentUser.role != 'BP'">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name"><small>Current Device Software</small></div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <button class="btn btn-check-software" ng-hide="currentDeviceSoftware && currentDeviceSoftware != 'FAIL'" ng-click="checkCurrentDeviceSoftware(currentScope._id)">Check</button>
                                    <div class="field-value" ng-show="currentDeviceSoftware && currentDeviceSoftware != 'FAIL'">
                                        {{currentDeviceSoftware}}
                                    </div>
                                    <span class="help-block" ng-show="currentDeviceSoftware == 'FAIL'" style="color: #e74c3c">Failed to check. Please try again.</span>
                                    <br/><br/>
                                </div>
                            </div>
                            <div class="row detail-item" ng-show="currentUser.role == 'BP' && currentScope.deviceSoftware && currentScope.deviceSoftware.length">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name"><small>Update Device Software</small></div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <select id="selSoftwareToUpdate" name="selSoftwareToUpdate" class="form-control" ng-model="softwareToUpdate" ng-change="" data-placeholder="Choose a software">
                                        <option value="">Choose a software</option>
                                        <option ng-repeat="software in currentScope.deviceSoftware | orderBy:'uploadedDate'" ng-show="software.version" value="{{software.version}}">{{software.version}}</option>
                                    </select>
                                    <span class="help-block" ng-show="deviceSoftwareUpdateStatus == 'EMPTY'" style="color: #e74c3c">Please choose a software to install.</span>
                                    <span class="help-block" ng-show="deviceSoftwareUpdateStatus == 'FAIL'" style="color: #e74c3c">Software update failed. Please try again.</span>
                                    <span class="help-block" ng-show="deviceSoftwareUpdateStatus == 'SUCCESS'" style="color: #2a6496">Software update has been scheduled successfully and will be performed soon. You can check in a while.</span>
                                    <button class="btn btn-update-software" ng-click="updateDeviceSoftware(currentScope._id, softwareToUpdate)">Update</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row slide-sources-panel scope" id="related-sources-section" style="margin-bottom: 60px">
                <div class="col-md-12 col-sm-12 slide-source-head">
                    <h3 ng-click="slideRelatedSources($event, 'click');">Related Scopes<span><i class="fa fa-chevron-down"></i></span></h3>
                </div>
                <div class="col-md-12 col-sm-12">
                    <div class="section related-sources-section">
                        <div class="section-head">
                            <h4 class="section-title"><span class="text">Related Scopes</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-add-scope" ng-click="scopeNesting = true; resetDeviceSoftwareUpload(); activePanelIndex = 6;"><span class="icon icon-bv-add"></span><span class="text">Add Nested Scope</span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <ul class="source-list" id="dataloger-list-section">
                                <li class="source-item type-scope scope-{{scope._id}}" ng-repeat="scope in currentScope.childTags | filter: {tagType: 'Scope'} | orderBy:'name'" ng-init="scope.toggleDelete = false">
                                    <div ng-show="!scope.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showScopeDetail(scope, 'nested')"><i class="icon-source-type"></i>{{scope.name || 'Unnamed Scope'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(scope, 'scope', 'list', 'show', $event)"></i></h4>
                                        <p>{{scope.deviceID}}</p>
                                    </div>
                                    <delete-dialog ng-show="scope.toggleDelete" data-yes="deleteScope(scope._id, 'list')" data-no="toggleDeleteSource(scope, 'scope', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row slide-sources-panel scope" id="related-sources-section">
                <div class="col-md-12 col-sm-12 slide-source-head">
                    <h3 ng-click="slideRelatedSources($event, 'click');">Related Nodes<span><i class="fa fa-chevron-down"></i></span></h3>
                </div>
                <div class="col-md-12 col-sm-12">
                    <div class="section related-sources-section">
                        <div class="section-head">
                            <h4 class="section-title"><span class="text">Related Nodes</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-add-node" ng-click="activePanelIndex=8;  addNode.weatherStation = '--Use NOAA--'; addNode.latitude = currentScope.latitude; addNode.longitude = currentScope.longitude;"><span class="icon icon-bv-add"></span><span class="text">Add Node</span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <ul class="source-list">
                                <li class="source-item type-node node-{{node._id}}" ng-repeat="node in currentScope.childTags | filter: {tagType: 'Node'} | orderBy:'name'" ng-init="node.toggleDelete = false">
                                    <div ng-show="!node.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showNodeDetail(node, 'normal')"><i class="icon-source-type"></i>{{node.name || 'Unnamed Node'}}</a><i class="icon-bv-trash" ng-click="toggleDeleteSource(node, 'node', 'list', 'show', $event)"></i></h4>
                                        <p>{{node.device + ' ' + node.deviceID}}</p>
                                    </div>
                                    <delete-dialog ng-show="node.toggleDelete" data-yes="deleteNode(node._id, 'list')" data-no="toggleDeleteSource(node, 'node', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of scope details panel -->

    <!-- Start of create node panel -->
    <div class="panel create-node-panel" ng-show="activePanelIndex == 8">
        <div class="panel-header has-border">
            <h4 class="panel-title">Add Node</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(createNodeForm); activePanelIndex = 2"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <form name="createNodeForm" class="form-horizontal source-form" ng-submit="createNode(createNodeForm)" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeName.$invalid && (createNodeForm.addNodeName.$dirty || submitted)}">
                                <label for="addNodeName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.name" name="addNodeName" id="addNodeName" class="form-control" required/>
                                    <span class="help-block" ng-show="createNodeForm.addNodeName.$error.required && (createNodeForm.addNodeName.$dirty || submitted)">Please input a node name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeDisplayName.$invalid && (createNodeForm.addNodeDisplayName.$dirty || submitted)}">
                                <label for="addNodeDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.displayName" name="addNodeDisplayName" id="addNodeDisplayName" class="form-control">
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeMfr.$invalid && (createNodeForm.addNodeMfr.$dirty || submitted)}">
                                <label for="addNodeMfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addNodeMfr" name="addNodeMfr" data-placeholder="" data-model="addNode.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createNodeForm.addNodeMfr.$error.required && (createNodeForm.addNodeMfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeDevice.$invalid && (createNodeForm.addNodeDevice.$dirty || submitted)}">
                                <label for="addNodeDevice" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="addNodeDevice" name="addNodeDevice" data-placeholder="" data-model="addNode.device" data-func="getDevices" data-selected="selectedAddNodeDevice" data-loading="deviceLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="createNodeForm.addNodeDevice.$error.required && (createNodeForm.addNodeDevice.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeDeviceId.$invalid && (createNodeForm.addNodeDeviceId.$dirty || submitted)}">
                                <label for="addNodeDeviceId" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <!--input type="text" name="addNodeDeviceId" id="addNodeDeviceId" ng-model="addNode.deviceID" class="form-control" required/-->
                                    <!--select name="addNodeDeviceId" id="addNodeDeviceId" ng-model="addNode.deviceID" class="form-control" required>
                                        <option ng-repeat="deviceID in addNodeDeviceIDList" value="{{deviceID}}">{{deviceID}}</option>
                                    </select-->
                                    <ui-select  name="addNodeDeviceId" ng-model="addNode.deviceID" theme="bootstrap" reset-search-input="false" required="true">
                                        <ui-select-match>
                                            <span>{{$select.selected || $select.search}}</span>
                                            <!--a class="btn btn-xs btn-link pull-right" ng-click="clearDeviceIdInput($event, $select)"><i class="glyphicon glyphicon-remove"></i></a-->
                                        </ui-select-match>
                                        <ui-select-choices repeat="device in (addNodeDeviceIDList | filter: $select.search)" refresh="refreshAddNodeDeviceIDResults($select)" refresh-delay="0">
                                            <span>{{device}}</span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <span class="help-block" ng-show="createNodeForm.addNodeDeviceId.$error.required && (createNodeForm.addNodeDeviceId.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeTarget.$invalid && (createNodeForm.addNodeTarget.$dirty || submitted)}">
                                <label for="addNodeTarget" class="col-sm-3 control-label">Node Target</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.sensorTarget" name="addNodeTarget" id="addNodeTarget" class="form-control" required/>
                                    <span class="help-block" ng-show="createNodeForm.addNodeTarget.$error.required && (createNodeForm.addNodeTarget.$dirty || submitted)">Please input a node target.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeType.$invalid && (createNodeForm.addNodeType.$dirty || submitted)}">
                                <label for="addNodeType" class="col-sm-3 control-label">Node Type</label>
                                <div class="col-sm-9">
                                    <select ng-model="addNode.nodeType" name="addNodeType" id="addNodeType" class="form-control" data-placeholder="Select Node Type" required>
                                        <option value="">--- Use NOAA ---</option>
                                        <option value="Solar">Solar</option>
                                        <option value="Generation">Generation</option>
                                        <option value="Supply">Supply</option>
                                        <option value="Demand">Demand</option>
                                        <option value="Thermostat">Thermostat</option>
                                    </select>
                                    <span class="help-block" ng-show="createNodeForm.addNodeType.$error.required && (createNodeForm.addNodeType.$dirty || submitted)">Please select a node type.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeInterval.$invalid && (createNodeForm.addNodeInterval.$dirty || submitted)}">
                                <label for="addNodeInterval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="addNode.interval" name="addNodeInterval" id="addNodeInterval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="createNodeForm.addNodeInterval.$error.required && (createNodeForm.addNodeInterval.$dirty || submitted)">Please input a interval.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeLat.$invalid && (createNodeForm.addNodeLat.$dirty || submitted)}">
                                <label for="addNodeLat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.latitude" name="addNodeLat" id="addNodeLat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(createNodeForm.addNodeLat.$error.number || createNodeForm.addNodeLat.$error.required) && (createNodeForm.addNodeLat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeLng.$invalid && (createNodeForm.addNodeLng.$dirty || submitted)}">
                                <label for="addNodeLng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.longitude" name="addNodeLng" id="addNodeLng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(createNodeForm.addNodeLng.$error.number || createNodeForm.addNodeLng.$error.required) && (createNodeForm.addNodeLng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodeWxStation.$invalid && (createNodeForm.addNodeWxStation.$dirty || submitted)}">
                                <label for="addNodeWxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addNode.weatherStation" name="addNodeWxStation" id="addNodeWxStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="createNodeForm.addNodeWxStation.$error.required && (createNodeForm.addNodeWxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': createNodeForm.addNodePotenTialPower.$invalid && (createNodeForm.addNodePotenTialPower.$dirty || submitted)}">
                                <label for="addNodePotenTialPower" class="col-sm-3 control-label">PotenTial Power</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="addNode.potentialPower" name="addNodePotenTialPower" id="addNodePotenTialPower" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="(createNodeForm.addNodePotenTialPower.$error.number || createNodeForm.addNodePotenTialPower.$error.required) && (createNodeForm.addNodePotenTialPower.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="inputBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="addNode.bpLock" name="inputBpLock" id="inputBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 250px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit" ng-disabled="currentUser.enphaseUserId == null && addNode.manufacturer == 'Enphase'">Add Node</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createNodeForm);activePanelIndex = 2">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of create node panel -->

    <!-- Start of update node panel -->
    <div class="panel edit-node-panel" ng-show="activePanelIndex == 9">
        <div class="panel-header has-border">
            <h4 class="panel-title">Update Node</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(updateNodeForm); activePanelIndex = 3"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <form name="updateNodeForm" class="form-horizontal source-form" ng-submit="updateNode(updateNodeForm)" novalidate="novalidate">
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeName.$invalid && (updateNodeForm.editNodeName.$dirty || submitted)}">
                                <label for="editNodeName" class="col-sm-3 control-label">Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editNode.name" name="editNodeName" id="editNodeName" class="form-control" required/>
                                    <span class="help-block" ng-show="editNodeName.editNodeName.$error.required && (editNodeName.editNodeName.$dirty || submitted)">Please input a node name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeDisplayName.$invalid && (updateNodeForm.editNodeDisplayName.$dirty || submitted)}">
                                <label for="editNodeDisplayName" class="col-sm-3 control-label">Display Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editNode.displayName" name="editNodeDisplayName" id="editNodeDisplayName" class="form-control" />
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeMfr.$invalid && (updateNodeForm.editNodeMfr.$dirty || submitted)}">
                                <label for="editNodeMfr" class="col-sm-3 control-label">Manufacturer</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="editNodeMfr" name="editNodeMfr" data-placeholder="" data-model="editNode.manufacturer" data-func="getManufacturers" data-loading="manufacturerLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeMfr.$error.required && (updateNodeForm.editNodeMfr.$dirty || submitted)">Please input a manufacturer.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeDevice.$invalid && (updateNodeForm.editNodeDevice.$dirty || submitted)}">
                                <label for="editNodeDevice" class="col-sm-3 control-label">Device</label>
                                <div class="col-sm-9">
                                    <predictive-auto-complete id="editNodeDevice" name="editNodeDevice" data-placeholder="" data-model="editNode.device" data-func="getDevices" data-loading="deviceLoading" data-required></predictive-auto-complete>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeDevice.$error.required && (updateNodeForm.editNodeDevice.$dirty || submitted)">Please input a device name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeDeviceID.$invalid && (updateNodeForm.editNodeDeviceID.$dirty || submitted)}">
                                <label for="editNodeDeviceID" class="col-sm-3 control-label">Device ID</label>
                                <div class="col-sm-9">
                                    <input type="text" name="editNodeDeviceID" id="editNodeDeviceID" class="form-control" ng-model="editNode.deviceID" required readonly/>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeDeviceID.$error.required && (updateNodeForm.editNodeDeviceID.$dirty || submitted)">Please input a device ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeTarget.$invalid && (updateNodeForm.editNodeTarget.$dirty || submitted)}">
                                <label for="editNodeTarget" class="col-sm-3 control-label">Node Target</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editNode.sensorTarget" name="editNodeTarget" id="editNodeTarget" class="form-control" required/>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeTarget.$error.required && (updateNodeForm.editNodeTarget.$dirty || submitted)">Please input a node target.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.addNodeType.$invalid && (updateNodeForm.editNodeType.$dirty || submitted)}">
                                <label for="editNodeType" class="col-sm-3 control-label">Node Type</label>
                                <div class="col-sm-9">
                                    <select ng-model="editNode.nodeType" name="editNodeType" id="editNodeType" class="form-control" data-placeholder="Select Node Type" required>
                                        <option value="">--- Use NOAA ---</option>
                                        <option value="Solar">Solar</option>
                                        <option value="Generation">Generation</option>
                                        <option value="Supply">Supply</option>
                                        <option value="Demand">Demand</option>
                                        <option value="Thermostat">Thermostat</option>
                                    </select>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeType.$error.required && (updateNodeForm.editNodeType.$dirty || submitted)">Please select a node type.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeInterval.$invalid && (updateNodeForm.editNodeInterval.$dirty || submitted)}">
                                <label for="editNodeInterval" class="col-sm-3 control-label">Interval</label>
                                <div class="col-sm-9">
                                    <select ng-model="editNode.interval" name="editNodeInterval" id="editNodeInterval" class="form-control" data-placeholder="Select Interval" required>
                                        <option value="">--- Select Interval ---</option>
                                        <option value="Hourly">Hourly</option>
                                        <option value="Daily">Daily</option>
                                        <option value="Weekly">Weekly</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Yearly">Yearly</option>
                                    </select>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeInterval.$error.required && (updateNodeForm.editNodeInterval.$dirty || submitted)">Please input a interval.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeLat.$invalid && (updateNodeForm.editNodeLat.$dirty || submitted)}">
                                <label for="editNodeLat" class="col-sm-3 control-label">Latitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editNode.latitude" name="editNodeLat" id="editNodeLat" class="form-control" placeholder="Example: 40.7127" required/>
                                    <span class="help-block" ng-show="(updateNodeForm.editNodeLat.$error.number || updateNodeForm.editNodeLat.$error.required) && (updateNodeForm.editNodeLat.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeLng.$invalid && (updateNodeForm.editNodeLng.$dirty || submitted)}">
                                <label for="editNodeLng" class="col-sm-3 control-label">Longitude</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editNode.longitude" name="editNodeLng" id="editNodeLng" class="form-control" placeholder="Example: 74.0059" required/>
                                    <span class="help-block" ng-show="(updateNodeForm.editNodeLng.$error.number || updateNodeForm.editNodeLng.$error.required) && (updateNodeForm.editNodeLng.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodeWxStation.$invalid && (updateNodeForm.editNodeWxStation.$dirty || submitted)}">
                                <label for="editNodeWxStation" class="col-sm-3 control-label">Weather Station</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="editNode.weatherStation" name="editNodeWeatherStation" id="editNodeWeatherStation" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="updateNodeForm.editNodeWxStation.$error.required && (updateNodeForm.editNodeWxStation.$dirty || submitted)">Please input a weather station.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-class="{'has-error': updateNodeForm.editNodePotenTialPower.$invalid && (updateNodeForm.editNodePotenTialPower.$dirty || submitted)}">
                                <label for="editNodePotenTialPower" class="col-sm-3 control-label">PotenTial Power</label>
                                <div class="col-sm-9">
                                    <input type="number" ng-model="editNode.potentialPower" name="editNodePotenTialPower" id="editNodePotenTialPower" class="form-control" placeholder="" required/>
                                    <span class="help-block" ng-show="(updateNodeForm.editNodePotenTialPower.$error.number || updateNodeForm.editNodePotenTialPower.$error.required) && (updateNodeForm.editNodePotenTialPower.$dirty || submitted)">Please input a number.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-hide="currentUser.role != 'BP'">
                                <label for="inputBpLock" class="col-sm-3 control-label">BP-Lock</label>
                                <div class="col-sm-9">
                                    <input type="checkbox" ng-model="editNode.bpLock" name="inputBpLock" id="inputBpLock" class="form-checkbox" />
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 250px;">
                                            <button class="btn btn-companypanel-green btn-add-metric" type="submit" ng-disabled="currentUser.enphaseUserId == null && editNode.manufacturer == 'Enphase'">Update Node</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(updateNodeForm); activePanelIndex = 3">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of update node panel -->

    <!-- Start of node details panel -->
    <div class="panel node-details-panel" ng-show="activePanelIndex == 3">
        <div class="panel-header clearfix">
            <h4 class="panel-title">Node</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="backScopeDetail()"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section section-well create-source-section clearfix">
                        <p class="description">Here you can manage all data sources and related items <i class="bv-marker bv-facilities"></i><span class="custom-text color-damson">Facilities</span><i class="bv-marker bv-scopes"></i><span class="custom-text color-orange">Scopes</span> and <i class="bv-marker bv-nodes"></i><span class="custom-text color-green">Nodes</span></p>
                        <a class="btn btn-bv-default btn-create-source" ng-click="openCreateFacility();"><span class="icon icon-bv-add"></span><span class="text">Create Sources</span></a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section search-section">
                        <input type="text" class="form-control" placeholder="Search" ng-model="searchTag.name" ng-change="backToSearchResult()">
                        <span class="icon bv-find"></span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="filter-panel section">
                        <ul class="filter-list">
                            <li class="type-facility">
                                <input type="checkbox" ng-model="showFacilities" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-damson">Facilities</span>
                            </li>
                            <li class="type-scope">
                                <input type="checkbox" ng-model="showScopes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-orange">Scopes</span>
                            </li>
                            <li class="type-node">
                                <input type="checkbox" ng-model="showNodes" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-green">Nodes</span>
                            </li>
                            <li class="type-metric">
                                <input type="checkbox" ng-model="showMetrics" ng-change="backToSearchResult()">
                                <span class="icon-source-type"></span>
                                <span class="custom-text color-dark-blue">Metrics</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="separater"></div>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section detail-section node-detail-section">
                        <delete-dialog ng-show="currentNode.toggleDelete" data-yes="toggleDeleteSource(currentNode, 'node', 'detail','hide'); deleteNode(currentNode._id, 'detail');" data-no="toggleDeleteSource(currentNode, 'node', 'detail','hide');" data-message="Really Delete?"></delete-dialog>
                        <div class="section-head">
                            <h4 class="section-title"><span class="icon bv-marker bv-nodes"></span><span class="text color-green">{{currentNode.name || 'Unnamed Node'}}</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-edit-node" ng-click="openEditNode();"><span class="icon icon-bv-edit"></span><span class="text">Edit</span></a>
                                <a class="btn btn-delete-node" title="Sorry,we can't delete it now" tooltip="Sorry,we can't delete it now" ng-click="toggleDeleteSource(currentNode, 'node', 'detail','show', $event);"><span class="icon icon-delete"></span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Display Name</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.displayName || currentNode.name }}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Manufacturer</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.manufacturer || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Device</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.device || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Node Target</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.sensorTarget || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Node Type</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.nodeType || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Interval</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.interval || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Latitude</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.latitude || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Longitude</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.longitude || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Weather station</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{currentNode.weatherStation || 'Default'}}</div>
                                </div>
                            </div>
                            <div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">Shared with</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value" ng-bind="currentNode.accessibleUsers || 'None'"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row slide-sources-panel node" id="related-sources-section">
                <div class="col-md-12 col-sm-12 slide-source-head">
                    <h3 ng-click="slideRelatedSources($event, 'click');">Related Metrics<span><i class="fa fa-chevron-down"></i></span></h3>
                </div>
                <div class="col-md-12 col-sm-12">
                    <div class="section related-sources-section">
                        <div class="section-head">
                            <h4 class="section-title"><span class="text">Related Metrics</span></h4>
                            <div class="head-tools">
                                <a class="btn btn-bv-default btn-add-scope" ng-click="openCreateMetric();"><span class="icon icon-bv-add"></span><span class="text">Add Metric</span></a>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div class="section-body" m-custom-scrollbar="">
                            <ul class="source-list">
                                <li class="source-item type-metric metric-{{metric._id}}" ng-repeat="metric in currentNode.childTags | orderBy:'name'" ng-init="metric.toggleDelete = false">
                                    <div ng-show="!metric.toggleDelete" class="animation-show">
                                        <h4 class="item-title"><a class="item-link " ng-click="showMetricDetail(metric, 'normal')"><i class="icon-source-type"></i>{{metric.name || 'Unnamed Metric'}}<i class="bv-brighter-personal"></i></a><i class="icon-bv-trash" ng-click="toggleDeleteSource(metric, 'metric', 'list', 'show', $event)"></i></h4>
                                        <p>{{metric.formula_string || ''}}</p>
                                    </div>
                                    <delete-dialog ng-show="metric.toggleDelete" data-yes="deleteMetric(metric._id)" data-no="toggleDeleteSource(metric, 'metric', 'list', 'hide')" data-message="Really Delete?"></delete-dialog>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of node details panel -->

    <!-- Start of create metric panel -->
    <div class="panel create-metric-panel" ng-show="activePanelIndex == 10">
        <div class="panel-header has-border">
            <h4 class="panel-title">{{metricEventName}} Metric</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="initializeFormValidation(createMetricForm); backNodeDetail()"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body" id="metric-formula">
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="section source-form-section" m-custom-scrollbar="">
                        <form name="createMetricForm" class="form-horizontal source-form" ng-submit="(metricEventName == 'Add') ? createMetric(createMetricForm) : updateMetric(createMetricForm)" novalidate="novalidate">
                            <div class="form-group" ng-init="addMetric.metricList = ''" ng-class="{'has-error': createMetricForm.addMetricList.$invalid && (createMetricForm.addMetricList.$dirty || submitted)}">
                                <label for="addMetricList" class="col-sm-3 control-label">Metric</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.metricList" id="addMetricList" name="addMetricList" class="form-control" data-placeholder="Choose metric from the list" ng-change="selectMetricList()" required>
                                        <option value=""></option>
                                        <option ng-repeat="metric in metricList" ng-show="checkMetricName(metric.name)" value="{{metric.name}}">{{metric.name}}</option>
                                        <option value="custom">--Custom--</option>
                                    </select>
                                    <span class="help-block" ng-show="createMetricForm.addMetricList.$error.required && (createMetricForm.addMetricList.$dirty || submitted)">Please choose a metric type.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addMetric.metricList != ''" ng-init="addMetric.summaryMethod = 'Total'" ng-class="{'has-error': createMetricForm.addMetricSummaryMethod.$invalid && (createMetricForm.addMetricSummaryMethod.$dirty || submitted)}">
                                <label for="addMetricSummaryMethod" class="col-sm-3 control-label">Summary Method</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.summaryMethod" id="addMetricSummaryMethod" name="addMetricSummaryMethod" class="form-control" required>
                                        <option value="Total">Total</option>
                                        <option value="Average">Average</option>
                                        <option value="Count">Count</option>
                                        <option value="Minimum">Minimum</option>
                                        <option value="Maximum">Maximum</option>
                                        <option value="Median">Median</option>
                                    </select>
                                    <span class="help-block" ng-show="createMetricForm.addMetricSummaryMethod.$error.required && (createMetricForm.addMetricSummaryMethod.$dirty || submitted)">Please choose a summary method.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="addMetric.metricList != ''" ng-init="addMetric.metricType = 'Datafeed'">
                                <label for="addMetricType" class="col-sm-3 control-label">Metric Type</label>
                                <div class="col-sm-9">
                                    <select ng-model="addMetric.metricType" id="addMetricType" name="addMetricType" class="form-control" required>
                                        <option value="Datafeed">Datafeed</option>
                                        <option value="Calculated">Calculated</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricList != '')" ng-class="{'has-error': createMetricForm.addMetricID.$invalid && (createMetricForm.addMetricID.$dirty || submitted)}">
                                <label for="addMetricID" class="col-sm-3 control-label">Metric ID</label>
                                <div class="col-sm-9">
                                    <!--input type="text" ng-model="addMetric.metricID" id="addMetricID" name="addMetricID" class="form-control" required ng-readonly="metricEventName == 'Update'"-->
                                    <!--select ng-model="addMetric.metricID" id="addMetricID" name="addMetricID" class="form-control" required ng-disabled="metricEventName == 'Update'">
                                        <option ng-repeat="metricID in addMetricsDeviceIdList" value="{{metricID}}">{{metricID}}</option>
                                    </select-->
                                    <ui-select id="addMetricID" name="addMetricID" ng-model="addMetric.metricID" theme="bootstrap" reset-search-input="false" required="true" ng-disabled="metricEventName == 'Update'">
                                        <ui-select-match>
                                            <span>{{$select.selected || $select.search}}</span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="device in (addMetricsDeviceIdList | filter: $select.search)" refresh="refreshAddMetricsDeviceIDResults($select)" refresh-delay="0">
                                            <span>{{device}}</span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <span class="help-block" ng-show="createMetricForm.addMetricID.$error.required && (createMetricForm.addMetricID.$dirty || submitted)">Please input a metric ID.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricList == 'custom') && (addMetric.metricList != '')" ng-class="{'has-error': createMetricForm.addMetricName.$invalid && (createMetricForm.addMetricName.$dirty || submitted)}">
                                <label for="addMetricName" class="col-sm-3 control-label">Metric Name</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addMetric.name" id="addMetricName" name="addMetricName" class="form-control" required>
                                    <span class="help-block" ng-show="createMetricForm.addMetricName.$error.required && (createMetricForm.addMetricName.$dirty || submitted)">Please input a metric name.</span>
                                </div>
                            </div>
                            <div class="form-group" ng-show="(addMetric.metricType == 'Calculated') && (addMetric.metricList != '')">
                                <label for="addMetricFormula" class="col-sm-3 control-label">Formula</label>
                                <div class="col-sm-9">
                                    <textarea class="form-control" id="addMetricFormula" name="addMetricFormula" ng-model="addMetric.formula"></textarea>
                                </div>
                            </div>
                            <div class="form-group" ng-if="(addMetric.metricList == 'Reimbursement')">
                                <label for="addReimbursementRate" class="col-sm-3 control-label">Reimbursement Rate</label>
                                <div class="col-sm-9">
                                    <input type="text" ng-model="addMetric.rate" id="addReimbursementRate" name="addReimbursementRate" class="form-control" required>
                                </div>
                            </div>
                            <div ng-show="metricEventName == 'Update'" class="form-group">
                                <label class="col-sm-3 control-label">Upload Data</label>
                                <div class="col-sm-9">
                                    <source-uploader info="metric"></source-uploader>
                                </div>
                            </div>
                            <!--<div class="row detail-item">
                                <div class="col-md-3 col-sm-3">
                                    <div class="field-name">External ID</div>
                                </div>
                                <div class="col-md-9 col-sm-9">
                                    <div class="field-value">{{addMetric.externalId}}</div>
                                </div>
                            </div>-->
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="border-wrapper">
                                        <div class="btn-group-wrapper" style="width: 242px;">
                                            <button type="submit" class="btn btn-companypanel-green btn-add-metric">{{metricEventName}} Metric</button>
                                            <a class="btn btn-link" ng-click="initializeFormValidation(createMetricForm); activePanelIndex=3">Cancel</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End of metric details panel -->

    <!-- Start of edit upload data panel -->
    <div class="panel edit-upload-source-panel" ng-show="activePanelIndex == 11">
        <div class="panel-header has-border">
            <h4 class="panel-title">{{sourceUploadInfo.name}} has been parsed</h4>
            <div class="panel-tools">
                <a class="btn btn-bv-default btn-back nav-right" ng-click="backToScope(1)"><span class="icon icon-bv-back"></span><span class="text">Back</span></a>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="panel-body">
            <div class="action-box">
                <div class="row">
                    <div class="col-md-12">
                        <p class="comment">We automatically parsed your data file {{sourceUploadInfo.name}}. Before submit this data please check carefully how data has been mapped.</p>
                    </div>
                </div>
            </div>

            <form name="dataSourceUploadForm" class="form-horizontal source-form" ng-submit="submitDataSources()">
                <div id="source_columns" class="row">
                    <div class="col-md-12 col-sm-12">
                        <div ng-repeat="metricField in metricSourceFields" class="form-group">
                            <label for="source_col_{{metricField.name}}" class="col-sm-3 control-label">{{metricField.name}}</label>
                            <div ng-class="{'has-error': metricField.column == '' && sourceUploadInfo.submitted}" class="col-sm-9">
                                <select ng-model="metricField.column" ng-change="changeSourceColumn()" id="source_col_{{metricField.name}}" name="{{metricField.name}}" class="form-control" required>
                                    <option ng-repeat="col in sourceUploadInfo.columns" value="{{col.value}}">{{col.name}}</option>
                                </select>
                                <span class="help-block" ng-show="metricField.column == '' && sourceUploadInfo.submitted && !sourceUploadInfo.result">Please select {{metricField.name}} column</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div ng-hide="sourceUploadInfo.result" class="has-border">
                    <h4 class="">{{sourceUploadInfo.name}} Preview</h4>
                </div>

                <div class="row">
                    <div ng-hide="sourceUploadInfo.result" class="col-md-12 col-sm-12">
                        <div class="section source-table-section" id="source_table_section" m-custom-scrollbar="yx">
                            <table class="source-data-table">
                                <thead>
                                <tr><th ng-repeat="col in sourceUploadInfo.columns" ng-class="{'selected': col.selected}">{{col.name}}</th></tr>
                                </thead>
                                <tbody>
                                <tr ng-repeat="row in sourceUploadInfo.filteredContents">
                                    <td ng-repeat="cell in row">{{cell}}</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div ng-hide="sourceUploadInfo.result" class="col-md-12 col-sm-12">
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div class="border-wrapper">
                                    <div class="btn-group-wrapper" style="width: 250px;">
                                        <button type="submit" ng-class="{'disabled': sourceUploadInfo.disabled}" class="btn btn-ok btn-apply-sources">Upload Data</button>
                                        <a class="btn btn-link" ng-click="backToScope(2)">Cancel</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div ng-show="sourceUploadInfo.result" class="col-md-12 col-sm-12">
                        <div class="form-group">
                            <div class="col-sm-12">
                                <div class="border-wrapper">
                                    <div class="btn-group-wrapper" style="width: 340px;">
                                        <span ng-show="sourceUploadInfo.result == 'success'" class="upload-desc">Data uploaded successfully</span>
                                        <span ng-show="sourceUploadInfo.result == 'fail'" class="upload-desc has-error">Data uploading failed</span>
                                        <a class="btn btn-link btn-back-to-scope" ng-click="backToScope(3)">Back to Scope</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- End of edit upload data panel -->

</div>
